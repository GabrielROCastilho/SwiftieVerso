<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="./js/sessao.js"></script>
    <title>Cadastro</title>
</head>

<body class="body-login-cadastro">
    <div class="alerta_erro">
        <div class="card_erro" id="cardErro">
          <span id="mensagem_erro"></span>
        </div>
      </div>
    <div class="container-login-cadastro">
        <div class="img-login-cadastro"></div>
        <div class="card">
            <h2>This is the very first page! 游뿰</h2>
            <div class="form">
                <div class="nome-completo">
                    <div class="ipt-campos">
                        <label>Primeiro nome</label>
                        <input type="text" id="ipt_primeiro_nome">
                    </div>
                    <div class="ipt-campos">
                        <label>Sobrenome</label>
                        <input type="text" id="ipt_sobrenome">
                    </div>
                </div>
                <div class="ipt-campos">
                    <label>Informe sua data de nascimento</label>
                    <input type="date" id="ipt_dt_nascimento">
                </div>
                <div class="ipt-campos">
                    <label>Informe seu CPF</label>
                    <input type="number" id="ipt_cpf">
                </div>
                <div class="ipt-campos">
                    <label>Informe seu e-mail</label>
                    <input type="text" id="ipt_email">
                </div>
                <div class="ipt-campos">
                    <label>Informe seu estado</label>
                    <select id="slc_estado"></select>
                </div>
                <div class="senha-confirmar_senha">
                    <div class="ipt-campos">
                        <label>Crie uma senha</label>
                        <input type="password" id="ipt_senha">
                    </div>
                    <div class="ipt-campos">
                        <label>Confirme sua senha</label>
                        <input type="password" id="ipt_senha_confirmada">
                    </div>
                </div>
                <div class="ipt-campos">
                    <label>Como quer ser chamado, swiftie?</label>
                    <input type="text" id="ipt_nickname">
                </div>
                <button onclick="cadastrar()" class="btn btn-cadastro">Cadastrar-se</button>
            </div>
            <div id="div_aguardar" class="loading-div"></div>
      
            <div id="div_erros_login"></div>
        </div>
    </div>
</body>
<script>
    const estados = ["Acre", "Alagoas", "Amap치", "Amazonas", "Bahia", "Cear치", "Distrito Federal", "Esp칤rito Santo", "Goi치s", "Maranh칚o", "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Par치", "Para칤ba", "Paran치", "Pernambuco", "Piau칤", "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", "Rond칪nia", "Roraima", "Santa Catarina", "S칚o Paulo", "Sergipe", "Tocantins"]
    const values = ["Acre", "Alagoas", "Amap치", "Amazonas", "Bahia", "Cear치", "Distrito Federal", "Esp칤rito Santo", "Goi치s", "Maranh칚o", "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Par치", "Para칤ba", "Paran치", "Pernambuco", "Piau칤", "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", "Rond칪nia", "Roraima", "Santa Catarina", "S칚o Paulo", "Sergipe", "Tocantins"]
    let options = '<option value=""></option>'

    for (var i = 0; i < estados.length; i++) {
        options += `<option value="${values[i]}">${estados[i]}</option>`
    }

    document.getElementById("slc_estado").innerHTML = options

    function cadastrar() {
        // aguardar();

        var primeiroNomeVar = ipt_primeiro_nome.value;
        var sobrenomeVar = ipt_sobrenome.value;
        var dtNascimentoVar = ipt_dt_nascimento.value;
        var cpfVar = ipt_cpf.value;
        var emailVar = ipt_email.value;
        var estadoVar = slc_estado.value;
        var senhaVar = ipt_senha.value;
        var senhaConfirmadaVar = ipt_senha_confirmada.value;
        var nicknameVar = ipt_nickname.value;

        if (
            primeiroNomeVar == "" ||
            sobrenomeVar == "" ||
            dtNascimentoVar == "" ||
            cpfVar == "" ||
            emailVar == "" ||
            estadoVar == "" ||
            senhaVar == "" ||
            senhaConfirmadaVar == "" ||
            nicknameVar == "" 
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Mensagem de erro para todos os campos em branco)";

            finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000);
        }

        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                primeiroNomeServer: primeiroNomeVar,
                sobrenomeServer: sobrenomeVar,
                dtNascimentoServer: dtNascimentoVar,
                cpfServer: cpfVar,
                emailServer: emailVar,
                estadoServer: estadoVar,
                senhaServer: senhaVar,
                nicknameServer: nicknameVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

        return false;
    }

    function sumirMensagem() {
        cardErro.style.display = "none";
    }
</script>

</html>